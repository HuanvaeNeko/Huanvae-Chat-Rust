# Auth 接口（Fetch API）

```js
const BASE = 'http://localhost:8080';
async function api(path, { method='GET', token, body }={}) {
  const headers = { 'Content-Type': 'application/json' };
  if (token) headers['Authorization'] = `Bearer ${token}`;
  const res = await fetch(`${BASE}${path}`, {
    method,
    headers,
    body: body ? JSON.stringify(body) : undefined,
  });
  const data = await res.json().catch(() => ({}));
  if (!res.ok) throw new Error(`${res.status} ${JSON.stringify(data)}`);
  return data;
}
```

## 注册（公开）
- 路径：`POST /api/auth/register`
- 请求体：`{ user_id, nickname, password, email }`
```js
await api('/api/auth/register', {
  method: 'POST',
  body: { user_id: 'u1', nickname: '用户一', password: 'Password123', email: 'u1@example.com' }
});
```

## 登录（公开）
- 路径：`POST /api/auth/login`
- 请求体：`{ user_id, password, device_info?, mac_address? }`
```js
const login = await api('/api/auth/login', {
  method: 'POST',
  body: { user_id: 'u1', password: 'Password123', device_info: 'Chrome', mac_address: '00:11:22:33:44:55' }
});
const token = login.access_token;
```

## 刷新（公开）
- 路径：`POST /api/auth/refresh`
- 请求体：`{ refresh_token }`
```js
const refreshed = await api('/api/auth/refresh', {
  method: 'POST',
  body: { refresh_token: login.refresh_token }
});
```

## 查看设备（受保护）
- 路径：`GET /api/auth/devices`
- 认证：`Authorization: Bearer <access_token>`
```js
const devices = await api('/api/auth/devices', { token });
```

## 删除设备（受保护）
- 路径：`DELETE /api/auth/devices/{device_id}`
- 认证：`Authorization: Bearer <access_token>`
```js
await api(`/api/auth/devices/${deviceId}`, { method: 'DELETE', token });
```

## 登出（受保护）
- 路径：`POST /api/auth/logout`
- 认证：`Authorization: Bearer <access_token>`
```js
await api('/api/auth/logout', { method: 'POST', token });
```